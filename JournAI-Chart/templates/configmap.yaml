apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "journai.fullname" . }}-backend-config
  labels:
    {{- include "journai.labels" . | nindent 4 }}
    app.kubernetes.io/component: backend
data:
  NODE_ENV: production
  PORT: "{{ .Values.backend.service.targetPort }}"
  
  # Database configuration - always use RDS
  DB_CLIENT: {{ .Values.secrets.db.client | quote }}
  DB_HOST: {{ .Values.secrets.db.host | quote }}
  DB_PORT: {{ .Values.secrets.db.port | quote }}
  DB_NAME: {{ .Values.secrets.db.name | quote }}
  DB_USER: {{ .Values.secrets.db.username | quote }}
  
  # Database SSL Configuration
  DB_SSL: {{ .Values.secrets.db.ssl.enabled | default false | quote }}
  DB_CA_CERT_PATH: "/etc/ssl/certs/rds-ca-cert.pem"
  
  # S3 Configuration
  S3_BUCKET_NAME: {{ .Values.secrets.aws.s3Bucket | quote }}
  AWS_REGION: {{ .Values.secrets.aws.region | quote }}